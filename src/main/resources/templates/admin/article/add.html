<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>添加文章</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="/admin/layui/css/layui.css" />
	<link rel="stylesheet" href="/admin/css/main.css" />
</head>

<body>
<div class="p-15">
	<form class="layui-form layui-form-pane" id="article-save-form" enctype="multipart/form-data">
		<div class="layui-row">
			  <div class="layui-col-xs8">
				  <div class="layui-col-xs9">

					<div class="layui-form-item">
						<label class="layui-form-label">文章标题</label>
						<div class="layui-input-block">
							<input name="title" autocomplete="off" placeholder="请输入文章标题" class="layui-input" type="text"  lay-verify="required" lay-verType="tips" lay-reqText="文章标题不能为空" />
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">文章作者</label>
						<div class="layui-input-block">
							 <input name="author" autocomplete="off"  placeholder="请输入文章作者" class="layui-input" type="text" lay-verify="required" lay-verType="tips" lay-reqText="文章作者不能为空" />
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">文章来源</label>
						<div class="layui-input-block">
							 <input name="source" autocomplete="off" placeholder="请输入文章来源" class="layui-input" type="text" lay-verify="required" lay-verType="tips" lay-reqText="文章来源不能为空" />
						</div>
					</div>
				  </div>

				  <div class="layui-col-xs3 pl-10">
					<div class="layui-form-item layui-upload">
						 <div class="layui-upload-drag" id="upload-drag">
							<i class="layui-icon">&#xe67c;</i>
							<p style="padding-top:8px;">点击上传缩略图</p>
						 </div>
						 <input id="image" name="image" type="hidden" />
					</div>
				  </div>

				  <div class="layui-form-item layui-form-text mr-10 mt-10">
						<label class="layui-form-label">文章简介</label>
						<div class="layui-input-block">
							<textarea style="height:106px" placeholder="请输入文章简介" class="layui-textarea" name="description" lay-verify="required" lay-verType="tips" lay-reqText="文章简介不能为空"></textarea>
						</div>
				  </div>
			  </div>

			  <div class="layui-col-xs4">
				<div class="layui-form-item">
					<label class="layui-form-label">文章分类</label>
					<div class="layui-input-block">
					  <select name="cid" lay-verify="required" lay-verType="tips" lay-reqText="请选择分类">
						<option value="">请选择分类</option>
						<th:block th:each="vo:${list}">
						<option th:value="${vo.cid}" th:text="${vo.name}"></option>
						</th:block>
					  </select>
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">标&emsp;&emsp;签</label>
					<div class="layui-input-block">
						<div class="layui-col-xs10">
							<input name=keywords autocomplete="off" readonly="true" placeholder="请选择标签" class="layui-input" type="text" lay-verify="required" lay-verType="tips" lay-reqText="请选择标签" />
						</div>
						<div class="layui-col-xs2 fr">
							<button class="layui-btn layui-btn-normal" type="button" onclick="showBox('选择标签', 600, 600, 1, '/admin/tag/index?type=1')">选择标签</button>
						</div>
					</div>
				</div>

				<div class="layui-form-item" pane="">
					<label class="layui-form-label">允许评论</label>
					<div class="layui-input-block">
						<input id="isComment" type="hidden" name="isComment"  value="normal" />
						<input lay-filter="switch-status" lay-skin="switch" lay-text="是|否" checked="true" type="checkbox" />
					</div>
				 </div>

				 <div class="layui-form-item" pane="">
					<label class="layui-form-label">是否发布</label>
					<div class="layui-input-block">
						<input id="status" type="hidden" name="status" value="normal" />
						<input lay-filter="switch-status" lay-skin="switch" lay-text="是|否" checked="true" type="checkbox" />
					</div>
				 </div>

				 <div class="layui-form-item" pane="">
					<label class="layui-form-label">是否置顶</label>
					<div class="layui-input-block">
						<input id="isTop" type="hidden" name="isTop" value="normal" />
						<input lay-filter="switch-status" lay-skin="switch" lay-text="是|否" type="checkbox" />
					</div>
				 </div>

				 <div class="layui-form-item">
					<label class="layui-form-label">发布时间</label>
					<div class="layui-input-block">
						<input id="createTime" name="createTime" th:value="${#dates.format(new java.util.Date().getTime(), 'yyyy-MM-dd HH:mm:ss')}" autocomplete="off" placeholder="请选择发布时间" class="layui-input" type="text">
					</div>
				 </div>
			  </div>
		</div>

		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">文章内容</label>
			<div class="layui-input-block">
				<textarea id="content" name="content" class="layui-textarea" lay-verify="content"></textarea>
			</div>
		</div>

		<div class="layui-form-item">
			<button class="layui-btn layui-btn-normal" type="button" lay-submit="article-save" lay-filter="article-save">
				<i class="layui-icon layui-icon-ok"></i> 提交
			</button>
			<button type="reset" class="layui-btn layui-btn-primary">
				<i class="layui-icon layui-icon-return"></i> 重置
			</button>
		</div>
	</form>
</div>

<script src="/admin/layui/layui.js"></script>
<script src="/admin/js/common.js"></script>
<script th:inline="javascript" type="text/javascript">
	layui.use(['jquery', 'form', 'layer','layedit'], function()
	{
		var $ = layui.jquery; layer = layui.layer, form = layui.form,layedit = layui.layedit;
		var laydate = layui.laydate; upload  = layui.upload;

		//发布时间
		laydate.render({
			elem: '#createtime',
			type: 'datetime'
		});

		//普通图片上传
		upload.render({
		    elem  : '#upload-drag',
		    accept: 'images',
		    url   : '/admin/article/upload',
		    done  : function(result)
		    {
		    	if(result.status)
		    	{
		    		$(".layui-upload #image").val(result.data.savename);
		    		$(".layui-upload #upload-drag").empty().append("<img src="+result.data.savename+" />");
		    	}else{
		    		layer.msg("上传图片错误");
		    	}
		    },
		    error: function(err)
		    {
		    	layer.msg("网络异常，请重新上传");
		    }
		});

		form.verify({
			content: function (value, item) {
				if (value.length < 0) {
					layer.msg("文章内容不能为空");
				}
			}
		});
		// 编辑器
	    var contIndex = layedit.build('content',{tool: ['strong', 'italic','underline','del','|','left','center','right','|','link','unlink','face','image','|','code']});
	    $(".layui-layedit").mouseleave(function()
   		{
   			if(layedit.getText(contIndex))
   			{
   				$("#content").text(layedit.getContent(contIndex));
   			}else{
   				$("#content").text('');
   			}
   		})

		//监听指定开关
		form.on('switch(switch-status)',
		function(data)
		{
			if(this.checked)
			{
				$("#status").val('normal');
			}else{
				$("#status").val('hidden');
			}
		});

		ajaxform('article-save', '/admin/article/insert', 'article-save-form',
		function(json)
		{
			if(json.code==200)
			{
				layer.msg(json.msg,	{time: 1000}, function()
				{
					window.location.href = json.data;
				})
			}else{
				layer.msg(json.msg);
			}
		})

		change = function(tag)
		{
			var tags = $("input[name=keywords]").val();

			if(!tags)
			{
				$("input[name=keywords]").val(tag);
			}else{
				$("input[name=keywords]").val(tags+','+tag);
			}
			layer.closeAll();
		}
	});
</script>
</body>
</html>
